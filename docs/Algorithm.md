# 乐驾语音算法说明

## 目录

[TOC]

## 前言

介绍乐驾在做语义理解的过程和思路. 算法是在讯飞提供分词的基础上来实现的.

关键词:

* 基于 API, 有的放矢, 效率高
* 无序理解, 倒序寻找关键词
* 副词互斥, 避免只找关键词的二义性
* 元组多维结果, 增加理解深度, 理解上下文

# 语音指令

## 前言

此模块列举了用户在使用乐驾的功能时可能会说的话, 每一种话只取了一种代表, 替换同义词可以扩展成多种不同的话. 

如果有上下文联系, 则列举了上下文对话.

## 地图

- 搜索附近的加油站
- 查找周围的酒店
- 附近的医院

## 导航(未定)

> 如果有`附近的` , `周围的` 等字眼, 用 searchPOI, 否则视为 searchLocal.

- 导航去附近的加油站
- 去周围的酒店
- 去中心校区
- 驾车去趵突泉
- 我要去千佛山

## 预约加油

- 打开预约加油界面
- 预约加油
- 我要预约加油

订单

- 我有哪些订单
  - 您在中石化宣武门加油站有 200 元 29.54 升 92 号汽油的订单.
- 加油订单
  - 您在中石化宣武门加油站有 200 元 29.54 升 92 号汽油的订单.
- 我的订单有哪些

## 美妙音乐

- 打开音乐界面
- 播放音乐
- 音乐
- 暂停音乐
- 暂停
- 上一首
- 下一首

播放频道

- 播放英文歌曲
- 播放中文歌曲

## 车辆信息

- 打开车辆信息(我的车辆)界面
- 显示车辆信息(我的车辆)界面

询问状态

- 我的车辆状态怎么样
    - 您的哪一辆车辆? (奥迪A4, 大众宝来, 沃尔沃S90)
        - 奥迪A4
            - 您的奥迪A4, 已行驶45466公里, 发动机和变速器性能正常, 车灯性能异常.
- 车辆状态怎么样
- 车辆状态如何

## 乐在驾驶

- 打开乐在驾驶界面
- 显示乐在驾驶界面

违章

- 我有违章吗
  - 您没有违章信息
- 车辆有违章信息吗
- 帮我查一查违章信息
    - 您的哪一辆车辆? (奥迪A4, 大众宝来, 沃尔沃S90)
        - 奥迪A4
            - 您的奥迪A4在山东省济南市舜华路有闯红灯的违章记录, 罚款200元, 请尽快处理

## 其他

> 明天 / 后天

- 明天天气怎么样
- 明天适合洗车吗

限行

- 明天限行吗
- 明天能开车吗
- 限行罚多少钱?
  - 京牌罚100块，不扣分。非京牌罚100块，扣3分
- 限行规则是什么
- 请问你先问哪一种? (私家车, 公务车)
    - 私家车
        - 限行时间段为周一至五的早7时至晚20时(法定节假日和公休日不限行), 限行范围为五环路以内（不包括五环路主路）
    - 公务车
        - 停驶时间为0时至24时, 停驶范围为本市行政区域内所有道路



# 第一种思路

## 前言

考虑主体为用户的一句话(已经分词后的). 从多级到二级再到一级, 一层一层的去掉关键词, 一层一层的剥掉外套, 直到核心操作.

名词解释

* 一级动词: 直接调用API
* 二级动词: 去掉东西, 过滤出 `核心词` 再调用API
* 多级: 一级一级操作. 需要不断降级, 直到有对应的API

算法思路覆盖了基本的情况

## 算法思路

### 一级动词

- ​播放 / 暂停
- 上一首 / 下一首

### 二级动词

- 打开 / 显示 ->
  - 某个界面#
- 搜索 / 查找
  - 地点
  - 附近的 / 周围的#
- 导航去 / 去 / 驾车去
  - 地点
- 播放
    - 英文歌曲
    - 中文歌曲

### 多级疑问

- 怎么样 / 如何
  - ​车辆状态
  - 天气
- 是什么 ->

### 多级

- 我要
    - 导航 / 去#
    - 预约加油#
    - 加油#
- 我有
    - 哪些
        - 订单#
        - 车辆信息#
    - 违章吗 待定
- 我的
  - 车辆#
  - 订单#
- 帮我
    - 查一查
        - 违章信息
        - 天气

### 多级时间状语

- 明天
    - 怎么样#
        - 天气
    - 适合
        - 洗车
        - 开车 (限行)
    - 限行
    - 能开车吗

    
### 一级名词

- 地图导航
- 预约加油
- 车辆信息
- 乐在驾驶
- 美妙音乐

其他

- 加油订单
- 音乐
- 违章信息

### 多级名词

- 附近的 / 周围的
    - 地点
- 限行
    - 罚多少钱
    - 规则
        - 请问你先问哪一种? (私家车, 公务车)

# 第二种思路

## 前言

换个角度, 从理解句子的角度来想, 太麻烦了, 句子千变万化.

从我能提供的 API 有哪些的角度来出发, 为什么这样考虑, **如果不是基于一种操作来写语义理解的过程, 就算你理解了这句话, 然而你并无相关的操作来满足这句话的要求.**

所以, 从 API 的角度来说, 能极大的提高算法的效率.

举个例子:

1. 播放英文歌曲
2. 我想播放英文歌曲
3. 我要播放英文歌曲
4. 乐驾, 给我播放英文歌曲
5. 今天心情比较开心, 给我播放英文歌曲

如果按**第一种思路**来的话:

对于第二和第三种情况, 我想 / 我要 这种代表多级操作的词, 没有任何意义. 所以需要去掉这种无用的词, 然后再判断交给哪个二级操作或者一级操作.

对于第四和第五种情况, 有些某些无关的状语从句, 还是要在分词的基础上判断有无关键词.

如果按**第二种思路**来的话: (在分词的基础上)

先找 `播放` 再找 `英文` 或者 `中文` 关键字, 就可以完成操作了. 

关键字 更是一种具有操作意义的 词.

不是完全倒序, 是按照重要程度的倒序, 由里到外的顺序, 操作API的顺序.

为什么要简化呢, 举个例子, 因为我不管多么的理解 `播放英文男歌手的歌曲` 这句话, 我没有相关的操作啊, 我就算知道了用户干嘛, 底层没有给我相关的API, 我也束手无策.

**倒序, 倒着念出来才符合中文逻辑**

**人为训练模型**

JSON / XML 无限嵌套就行

中文的习惯是把重要的放在后面

## 算法思路

句子的语义深度, 是以句子中的词为深度

上下文, 是以句子为单位的深度

### 地图

* 搜索 / 查找 / 寻找 / 在哪
    * 附近的 / 周围的
        * [地点] **searchPOI**
    * [地点] **searchLocal**


地图

* 地图
    * 显示 / 打开 / 界面

### 导航

* 导航 / 去 / 怎么走 / 驾车
    * 周围的 / 附近的
        * [地点] **naviPOI**
    * [地点] **naviLocal**



### 加油

* 加油
    * 打开 / 显示 / 界面
        * **showOnlineRefuel**
    * 预约
        * **showOnlineRefuel**
    * 订单 / 有哪些
        * **speechOrder**



### 音乐

* 音乐
    * 打开 / 显示 / 界面
        * **showMusic**
    * 播放
        * **play**
        * 中文 / 英文
            * **play(with: channel)**
    * 暂停
        * **pause**
    * 上一首
        * **pre**
    * 下一首
        * **next**

### 车辆信息

* 车辆
    * 信息
        * 打开 / 显示 / 界面
            * **showCarInfo**
    * 状态
        * 怎么样 / 如何
            * **askWhichCar && speechCarInfo**
    * 违章
        * 有 / 存在 / 是什么 ! 怎么 为什么 原因
            * * **askWhichCar && speech?Info**
        * 为什么 / 什么原因
            * * * **askWhichCar && speech?Reason**

> 车辆 -> 违章 -> 有 / 存在 ! 怎么
> 我的车辆有违章信息吗 匹配
> 我的车辆违章怎么处理 不匹配
> 我的车辆有违章信息怎么处理 不匹配
> 我的车辆有违章信息什么原因 不匹配

注意:

> 之前的 `有 / 存在 / 是什么 / 怎么 / 为什么 / 原因` 等属于多级操作的开头匹配关键词, 在第二种情况下属于关键词底下的互斥词, 互斥!
> 
> 这样是允许 不符合语言顺序 的话进行操作的, 为什么, 这样是有理论依据的, 人眼在阅读的时候, 大脑在处理信息的时候, 也是不分顺序的, 所以无顺序的信息不影响理解.

### 乐在驾驶

* 乐在驾驶
    * 打开 / 显示 / 界面
        * **showLifestyle**

违章

* 违章
    * 有 / 存在 / 是什么 ! 怎么 为什么 原因
        * **askWhichCar && speech?Info**
    * 为什么 / 什么原因
        * **askWhichCar && speech?Reason**
    * 查一查 / 查询 / 查找
        * **askWhichCar && speech?Reason**

其他

天气

* 天气
    * 怎么样 / 是什么
        * **speechWeather**

洗车

* 洗车
    * 适合 ! 在哪 是什么
        * **checkWeather && speechReason**

限行

* 限行
    * 明天 / 后天
        * **check && speech**
    * 钱
        * 罚
            * 多少
                * **check && speech**
    * 格则
        * 是什么 ! 为什么
            * **check && speech**









